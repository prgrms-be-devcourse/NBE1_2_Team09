<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>추천 장소 검색</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        /* 간단한 스타일 추가 */
        .place-type {
            cursor: pointer;
            margin: 5px;
            padding: 10px;
            border: 1px solid #ccc;
            display: inline-block;
            border-radius: 5px;
        }
        .place-type.selected {
            background-color: #d0e0ff; /* 선택된 항목 색상 */
        }
        .place-type:hover {
            background-color: #f0f0f0;
        }
        .suggestion-item {
            display: flex;
            align-items: center;
            cursor: pointer;
            margin: 5px 0;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .suggestion-item:hover {
            background-color: #f0f0f0;
        }
        .place-image {
            width: 50px; /* 이미지 크기 조절 */
            height: 50px; /* 이미지 크기 조절 */
            margin-right: 10px; /* 이미지와 텍스트 사이의 간격 */
            border-radius: 5px;
        }
        /* 선택된 장소의 색상 변경 */
        .selected-item {
            background-color: #d0e0ff;
        }
    </style>
</head>
<body>
<h1>추천 장소 검색</h1>

<h2>장소 유형:</h2>
<div id="placeTypes">
    <div class="place-type selected" data-type="establishment">모두</div>
    <div class="place-type" data-type="restaurant">맛집</div>
    <div class="place-type" data-type="tourist_attraction">관광지</div>
    <div class="place-type" data-type="lodging">숙소</div>
</div>

<h3>추천 장소:</h3>
<ul id="suggestions"></ul>

<script>
    const eventId = 1; // 서울 도시를 위한 eventId 예시

    // 페이지가 로드될 때 "모두" 유형으로 기본 추천 장소 가져오기
    $(document).ready(function() {
        fetchRecommendations('establishment'); // 기본적으로 모든 추천 장소 가져오기
    });

    // 장소 유형 클릭 이벤트 핸들러
    $('.place-type').on('click', function() {
        const type = $(this).data('type'); // 클릭한 요소에서 type 가져오기
        console.log("type", type); // 콘솔에 type 출력 (디버깅)

        // 선택된 유형에 클래스를 추가하고, 이전 선택 해제
        $('.place-type').removeClass('selected');
        $(this).addClass('selected');

        // fetchRecommendations 함수 호출
        fetchRecommendations(type);
    });

    // 추천 장소를 가져오는 함수
    function fetchRecommendations(type) {
        console.log("type", type); // 콘솔에 type 확인
        $.ajax({
            url: `http://localhost:8080/api/locations/${eventId}/recommend?type=${type}`, // AJAX 요청 URL
            method: 'GET',
            success: function(data) {
                $('#suggestions').empty(); // 기존 제안 목록 제거
                data.forEach(place => {
                    $('#suggestions').append(`
                        <li class="suggestion-item" data-id="${place.placeId}">
                            <img src="${place.photoUrl}" alt="${place.name}" class="place-image">
                            ${place.name}
                        </li>
                    `); // 이미지와 장소 이름 추가
                });

                // 목록 항목 클릭 이벤트 추가
                $('.suggestion-item').on('click', function() {
                    const placeId = $(this).data('id'); // 클릭한 항목의 placeId 가져오기
                    console.log("Clicked placeId:", placeId); // 콘솔에 placeId 출력

                    // 이전에 선택된 항목 초기화
                    $('.suggestion-item').removeClass('selected-item');

                    // 클릭한 항목에 선택된 클래스 추가
                    $(this).addClass('selected-item');
                });
            },
            error: function(xhr, status, error) {
                console.error("Error occurred:", xhr.responseText); // 오류 메시지 로그
                $('#suggestions').empty(); // 오류 시 제안 목록 제거
                $('#suggestions').append('<li>검색 중 오류가 발생했습니다.</li>');
            }
        });
    }
</script>

</body>
</html>
